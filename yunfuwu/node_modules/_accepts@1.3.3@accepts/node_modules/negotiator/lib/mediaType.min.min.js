"use strict";module.exports=preferredMediaTypes;module.exports.preferredMediaTypes=preferredMediaTypes;var simpleMediaTypeRegExp=/^\s*([^\s\/;]+)\/([^;\s]+)\s*(?:;(.*))?$/;function parseAccept(h){var i=splitMediaTypes(h);for(var j=0,f=0;j<i.length;j++){var g=parseMediaType(i[j].trim(),j);if(g){i[f++]=g}}i.length=f;return i}function parseMediaType(r,u){var t=simpleMediaTypeRegExp.exec(r);if(!t){return null}var x=Object.create(null);var z=1;var s=t[2];var q=t[1];if(t[3]){var p=splitParameters(t[3]).map(splitKeyValuePair);for(var v=0;v<p.length;v++){var w=p[v];var i=w[0].toLowerCase();var y=w[1];var j=y&&y[0]==='"'&&y[y.length-1]==='"'?y.substr(1,y.length-2):y;if(i==="q"){z=parseFloat(j);break}x[i]=j}}return{type:q,subtype:s,params:x,q:z,i:u}}function getMediaTypePriority(j,i,g){var k={o:-1,q:0,s:0};for(var l=0;l<i.length;l++){var h=specify(j,i[l],g);if(h&&(k.s-h.s||k.q-h.q||k.o-h.o)<0){k=h}}return k}function specify(k,h,g){var i=parseMediaType(k);var l=0;if(!i){return null}if(h.type.toLowerCase()==i.type.toLowerCase()){l|=4}else{if(h.type!="*"){return null}}if(h.subtype.toLowerCase()==i.subtype.toLowerCase()){l|=2}else{if(h.subtype!="*"){return null}}var j=Object.keys(h.params);if(j.length>0){if(j.every(function(a){return h.params[a]=="*"||(h.params[a]||"").toLowerCase()==(i.params[a]||"").toLowerCase()})){l|=1}else{return null}}return{i:g,o:h.i,q:h.q,s:l}}function preferredMediaTypes(k,h){var l=parseAccept(k===undefined?"*/*":k||"");if(!h){return l.filter(isQuality).sort(compareSpecs).map(getFullType)}var g=h.map(function i(a,b){return getMediaTypePriority(a,l,b)});return g.filter(isQuality).sort(compareSpecs).map(function j(a){return h[g.indexOf(a)]})}function compareSpecs(a,b){return(b.q-a.q)||(b.s-a.s)||(a.o-b.o)||(a.i-b.i)||0}function getFullType(b){return b.type+"/"+b.subtype}function isQuality(b){return b.q>0}function quoteCount(d){var f=0;var e=0;while((e=d.indexOf('"',e))!==-1){f++;e++}return f}function splitKeyValuePair(g){var f=g.indexOf("=");var e;var h;if(f===-1){e=g}else{e=g.substr(0,f);h=g.substr(f+1)}return[e,h]}function splitMediaTypes(g){var h=g.split(",");for(var e=1,f=0;e<h.length;e++){if(quoteCount(h[f])%2==0){h[++f]=h[e]}else{h[f]+=","+h[e]}}h.length=f+1;return h}function splitParameters(g){var h=g.split(";");for(var e=1,f=0;e<h.length;e++){if(quoteCount(h[f])%2==0){h[++f]=h[e]}else{h[f]+=";"+h[e]}}h.length=f+1;for(var e=0;e<h.length;e++){h[e]=h[e].trim()}return h};